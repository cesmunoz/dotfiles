#!/bin/bash
# Usage: cm-git-worktree <branch-name>
# Creates a git worktree for the given branch

set -e

if [ $# -lt 1 ]; then
  gum style --foreground 196 "Usage: $0 <branch-name>"
  gum style --foreground 244 "Example: $0 hotfix-stuff"
  exit 1
fi

BRANCH=$1
DIR="../$BRANCH"

# Confirm before creating
gum confirm "Create worktree for branch '$BRANCH' at '$DIR'?" || exit 0

gum style --foreground 39 "üì° Fetching origin..."
git fetch origin

# Create branch locally if it doesn't exist
if git show-ref --verify --quiet refs/heads/$BRANCH; then
  gum style --foreground 82 "‚úÖ Branch '$BRANCH' already exists locally"
else
  gum style --foreground 214 "‚ÑπÔ∏è Creating branch '$BRANCH' from origin/master"
  git branch "$BRANCH" origin/master
fi

# Add worktree
gum spin --spinner line --title "üìÇ Creating worktree at $DIR" -- \
  git worktree add "$DIR" "$BRANCH"

gum style --foreground 82 "‚úÖ Worktree created at $DIR"
